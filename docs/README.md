Single-Device Setup
-------------------

This section describes the setup process for Single-Device Mode. In this mode,
the user runs all of the code on their own machine and uploads directly to their
configured cloud storage provider. Only this machine may interact with the
archive.

First, create an account with a cloud object storage provider. There are
instructions on how to do this in the other files in this directory. Create a
configuration, which we'll call `utahfs.yaml`, with the following contents:

```yaml
storage-provider:
  s3-app-id: # Generated app id goes here.
  s3-app-key: # Generated app key goes here.
  s3-bucket: # Chosen bucket name.
  s3-url: # URL of service.
  s3-region: # Name of region.
  # S3 is for AWS or Wasabi, otherwise you'd need to remove the above and
  # configure Backblaze B2 access:
  # b2-acct-id:
  # b2-app-key:
  # b2-bucket:
  # b2-url:

# password: password123
# archive: true
```

and fill in the items under `storage-provider` with the credentials you got from
your storage provider.

The user can optionally set the encryption password in the configuration file by
uncommenting the line `password: password123` and replacing `password123` with
their actual password. Setting the password in the configuration file makes it
easier to use strong passwords, like those generated by running `$ openssl rand
-hex 16`. If the line is left commented, the user will be prompted for their
password when the client starts up. The password may not be changed once set.

Archive mode is enabled by uncommenting the line `archive: true`.

After this, the next step is to actually run the UtahFS client. Install it, if
you haven't already:

```
$ go install github.com/Bren2010/utahfs/cmd/utahfs-client
```

and run it with:

```
$ utahfs-client -cfg ./utahfs.yaml -mount ./utahfs
```

where `./utahfs.yaml` is the path to the configuration file, and `./utahfs` is
the path to the directory to mount. The directory to mount must already exist
and be empty.

You're done!


Multi-Device Setup
------------------

This section describes the setup process for Multi-Device Mode. In this mode,
the user needs to run a server process on trusted hardware. For example, a
Rasberry Pi or Intel NUC on their LAN are good candidates. The users' devices
interact only with the server, and the server handles uploads / downloads with
the cloud storage provider. This allows many users to work on the same archive
at once and can improve user-perceived performance.

First, create an account with a cloud object storage provider. There are
instructions on how to do this in the other files in this directory. Create a
file for the **server** configuration on the server, which we'll call
`utahfs-server.yaml`, with the following contents:

```yaml
storage-provider:
  s3-app-id: # Generated app id goes here.
  s3-app-key: # Generated app key goes here.
  s3-bucket: # Chosen bucket name.
  s3-url: # URL of service.
  s3-region: # Name of region.
  # S3 is for AWS or Wasabi, otherwise you'd need to remove the above and
  # configure Backblaze B2 access:
  # b2-acct-id:
  # b2-app-key:
  # b2-bucket:
  # b2-url:

transport-key: # Generate with: `openssl rand -hex 16`
```

and fill in the items under `storage-provider` with the credentials you got from
your storage provider. Generate a transport key with the command given above,
and fill that in as well. The transport key is a shared secret between the
client and server that allows them to authenticate with each other.

Install the server, if you haven't already:

```
$ go install github.com/Bren2010/utahfs/cmd/utahfs-server
```

and run it with:

```
$ utahfs-server -cfg ./utahfs-server.yaml
```

This process needs to be running at all times, so consider setting it up with a
systemd service or something similar.

Second, create a file for the **client** configuration, which we'll call
`utahfs.yaml`, with the following contents:

```yaml
remote-server:
  url: https://server:3002/
  transport-key: # Fill with the transport key generated previously.

# password: password123
# archive: true
```

Set `url` to be the URL of the server, and `transport-key` to be the same value
that you generated for the server's config. Refer to the section on
Single-Device Setup for information about `password` and `archive`.

Finally, install the UtahFS client, if you haven't already:

```
$ go install github.com/Bren2010/utahfs/cmd/utahfs-client
```

and run it with:

```
$ utahfs-client -cfg ./utahfs.yaml -mount ./utahfs
```

where `./utahfs.yaml` is the path to the configuration file, and `./utahfs` is
the path to the directory to mount. Again, the directory to mount must already
exist and be empty.

You're done!
